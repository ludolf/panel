/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={385:function(e){var t;t=()=>(()=>{var e={"./src/interpret.js":(e,t,s)=>{const{Types:r,Errors:n,Interruptions:i,InterpretError:o,Interrupt:a,Void:c}=s("./src/lang.js");class l{constructor(e={}){this.variables=[new Map],this.imports=e}clear(){this.variables=[new Map],this.imports&&Object.entries(this.imports).forEach((([e,t])=>this.variables[0].set(e,t)))}hasVariable(e){for(let t=this.variables.length-1;t>=0;t--){if(this.variables[t].has(e))return!0;if(this.variables[t].has("$")&&this.variables[t].get("$").hasAttribute(e))return!0}return!1}getVariable(e){for(let t=this.variables.length-1;t>=0;t--){if(this.variables[t].has(e))return this.variables[t].get(e);if(this.variables[t].has("$")){const s=this.variables[t].get("$");if(s.hasAttribute(e))return s.attribute(e)}}return!1}setVariable(e,t,s=!1){if(s)return void this.variables[this.variables.length-1].set(e,t);let r=!1;for(let s=this.variables.length-1;s>=0;s--)if(this.variables[s].has(e)){this.variables[s].set(e,t),r=!0;break}r||(this.variables.length||this.clear(),this.variables[this.variables.length-1].set(e,t))}pushScope(){this.variables.push(new Map)}popScope(){this.variables.pop()}}class u{constructor(e,t){this.maxSteps=e,this.isInterruptedFn=t,this.steps=0}step(e){if(this.isInterruptedFn&&this.isInterruptedFn())throw new a(i.USER_SUSSPEND);if(this.steps++,this.steps>this.maxSteps)throw new o(n.EXECUTION_STEPS_EXCEEDED,e)}reset(e=null){this.steps=0,e&&(this.maxSteps=e)}}e.exports=class{constructor(e={},t,s=1e5){this.variables=new l(e),this.stepper=new u(s,t&&t.isInterrupted)}async execute(e){return this.variables.clear(),this.stepper.reset(),await this.executeBlock(e,!1)}async executeBlock(e,t=!0){let s;t&&this.variables.pushScope();for(let t of e.statements)s=await this.executeStatement(t);return t&&this.variables.popScope(),s||new c}async executeStatement(e){return this.stepper.step(e.source),e.isExpression?await this.executeExpression(e):e.isAssignment?await this.executeAssignment(e):e.isWhile?await this.executeWhile(e):e.isIf?await this.executeIf(e):e}async executeExpression(e,t=null){if(this.stepper.step(e.source),!e.parts)throw new o(n.EMPTY_EXPRESSION,e.source);let s=[...e.parts];return await this.executeExpressionParts(s,t)}async executeExpressionParts(e,t=null){let s=u("&");if(s){const i=await this.executeExpressionParts(e.slice(0,s),t);if(i.type!==r.BOOLEAN)throw new o(n.WRONG_BI_OPERATOR_SUBJECTS,i.source);if(!i.value)return i;const a=await this.executeExpressionParts(e.slice(s+1),t);if(a.type!==r.BOOLEAN)throw new o(n.WRONG_BI_OPERATOR_SUBJECTS,a.source);return a}if(s=u("|"),s){const i=await this.executeExpressionParts(e.slice(0,s),t);if(i.type!==r.BOOLEAN)throw new o(n.WRONG_BI_OPERATOR_SUBJECTS,i.source);if(i.value)return i;const a=await this.executeExpressionParts(e.slice(s+1),t);if(a.type!==r.BOOLEAN)throw new o(n.WRONG_BI_OPERATOR_SUBJECTS,a.source);return a}let i=!1;for(;(s=a())>-1;){const a=e[s];if(t&&!a.isObjectAccess&&!a.isArrayAccess)throw new o(n.ACCESS_OPERATOR_EXPECTED,a.source);try{if(a.isUni){const t=await this.executeExpressionPart(e[s+1]);if(!t.type)throw new o(n.WRONG_UNI_OPERATOR_SUBJECT,a.source);e[s]=a.apply(t),e=c(e,s+1)}else if(a.isBi){const t=await this.executeExpressionPart(e[s-1]),r=await this.executeExpressionPart(e[s+1]);if(!t.type||!r.type)throw new o(n.WRONG_BI_OPERATOR_SUBJECTS,a.source);if(t.type!==r.type)throw new o(n.UNMATCHING_BI_OPERATOR_SUBJECTS,a.source);e[s]=a.apply(t,r),e=c(e,s-1,s+1)}else if(a.isArrayAccess){const u=await this.executeExpressionPart(e[s-1]);if(r.ARRAY!==u.type)throw new o(n.EXPECTED_ARRAY,a.source);if(t&&u.protected())throw new o(n.PROTECTED_FROM_MODIFICATION,a.source);const h=await Promise.all(a.indexes.map((e=>this.executeExpressionPart(e))));if(e[s]=a.apply(u,h,t&&l()?t:null),!e[s])throw new o(n.ATTRIBUTE_NOT_FOUND,a.source);e=c(e,s-1),i=!0}else if(a.isObjectAccess){const r=await this.executeExpressionPart(e[s-1]);if(!r.isObject)throw new o(n.EXPECTED_OBJECT,a.source);if(t&&r.protected())throw new o(n.PROTECTED_FROM_MODIFICATION,a.source);if(e[s]=a.apply(r,t&&l()?t:null),!e[s])throw new o(n.ATTRIBUTE_NOT_FOUND,a.source);e=c(e,s-1),i=!0}else{if(!a.isCall)throw new o(n.UNKNOWN_OPERATOR,a.source);{const t=await this.executeExpressionPart(e[s-1]),r=await Promise.all(a.params.map((e=>this.executeExpressionPart(e))));e[s]=await this.executeFunctionCall(t,r),e=c(e,s-1)}}}catch(e){if(!e.isLangError)throw new o(n.UNKNOWN_ERROR,a.source,e);if(!e.isInterpretError)throw new o(e.id,a.source,e.arg1,e.arg2);throw e}}if(t&&!i)throw new o(n.ACCESS_OPERATOR_EXPECTED,e[0].source);return await this.executeExpressionPart(e[0]);function a(){let t=-1,s=Number.MIN_SAFE_INTEGER;for(let r=0;r<e.length;r++){const n=e[r];n.isOperator&&(s<n.precedence||n.isUni&&s===n.precedence)&&(t=r,s=n.precedence)}return t}function c(e,...t){return e.filter(((e,s)=>!t.includes(s)))}function l(){return 2===e.length}function u(t){for(let s=0;s<e.length;s++)if(e[s].isBi&&e[s].op===t)return s}}async executeExpressionPart(e){if(this.stepper.step(e.source),e.isReference){if(!this.variables.hasVariable(e.varName))throw new o(n.UNREFERENCED_VARIABLE,e.source-e.varName.length,e.varName);return this.variables.getVariable(e.varName)}if(e.isExpression)return await this.executeExpression(e);if(r.ARRAY===e.type){const t=e.value;for(let e=0;e<t.length;e++)t[e]=await this.executeExpressionPart(t[e])}else if(r.OBJECT===e.type){const t=e.value;for(let s of Object.keys(t))t[s]=await this.executeExpressionPart(t[s]),(t[s].isObject||t[s].isFunction)&&(t[s].parent=e)}return e}async executeFunctionCall(e,t){if(e.isNative){return await e.call(...t)||new c}if(!t&&e.args||t.length!==e.args.length)throw new o(n.FUNC_ARGUMENTS_MISHMASH,e.source);let s=0;this.variables.pushScope();for(let r of e.args)this.variables.setVariable(r,t[s++],!0);e.parent&&this.variables.setVariable("$",e.parent,!0);try{return await this.executeBlock(e.body,!1)}finally{this.variables.popScope()}}async executeAssignment(e){if(!e.left||!e.right)throw new o(n.WRONG_ASSIGNMENT,e.source);const t=await this.executeExpressionPart(e.right);if(e.left.isVariable){const s=this.variables.getVariable(e.left.name);if(s.protected&&s.protected())throw new o(n.PROTECTED_FROM_MODIFICATION,e.left.source);this.variables.setVariable(e.left.name,t)}else{if(!e.left.isExpression)throw new o(n.WRONG_ASSIGNEE_TYPE);await this.executeExpression(e.left,t)}}async executeWhile(e){if(!e.condition||!e.condition.isExpression)throw new o(n.WRONG_CONDITION,e.source);for(;;){const t=await this.executeExpressionPart(e.condition);if(t.type!==r.BOOLEAN)throw new o(n.WRONG_CONDITION_VALUE,t.source);if(!t.value)break;await this.executeBlock(e.body)}}async executeIf(e){if(!e.condition||!e.condition.isExpression)throw new o(n.WRONG_CONDITION,e.source);const t=await this.executeExpressionPart(e.condition);if(t.type!==r.BOOLEAN)throw new o(n.WRONG_CONDITION_VALUE,t.source);t.value?await this.executeBlock(e.body):e.elseBody&&await this.executeBlock(e.elseBody)}}},"./src/lang.js":e=>{const t=["size","velikost","größe"],s={INVALID_UNI_OPERATOR:"INVALID_UNI_OPERATOR",INVALID_BI_OPERATOR:"INVALID_BI_OPERATOR",UNEXPECTED_END:"UNEXPECTED_END",UNEXPECTED_SYMBOL:"UNEXPECTED_SYMBOL",EXPECTED_SYMBOL:"EXPECTED_SYMBOL",UNREFERENCED_VARIABLE:"UNREFERENCED_VARIABLE",UNEXPEXTED_KEYWORD:"UNEXPEXTED_KEYWORD",INVALID_IDENTIFIER:"INVALID_IDENTIFIER",UNEVEN_OPERATORS:"UNEVEN_OPERATORS",EXPEXTED_FUNCTION:"EXPEXTED_FUNCTION",EXPEXTED_STATEMENT_END:"EXPEXTED_STATEMENT_END",ARRAY_INDEX_NOT_NUMBER:"ARRAY_INDEX_NOT_NUMBER",ARRAY_INDEX_MISSING:"ARRAY_INDEX_MISSING",ARRAY_INDEX_OUT_BOUNDS:"ARRAY_INDEX_OUT_BOUNDS",FUNC_ARGUMENTS_MISHMASH:"FUNC_ARGUMENTS_MISHMASH",ATTRIBUTE_ALREADY_EXISTS:"ATTRIBUTE_ALREADY_EXISTS",ATTRIBUTE_NOT_FOUND:"ATTRIBUTE_NOT_FOUND",ELEMENT_NOT_FOUND:"ELEMENT_NOT_FOUND",EMPTY_EXPRESSION:"EMPTY_EXPRESSION",UNKNOWN_OPERATOR:"UNKNOWN_OPERATOR",OPERATOR_NOT_APPLICABLE:"OPERATOR_NOT_APPLICABLE",ACCESS_OPERATOR_EXPECTED:"ACCESS_OPERATOR_EXPECTED",WRONG_UNI_OPERATOR_SUBJECT:"WRONG_UNI_OPERATOR_SUBJECT",WRONG_BI_OPERATOR_SUBJECTS:"WRONG_BI_OPERATOR_SUBJECTS",UNMATCHING_BI_OPERATOR_SUBJECTS:"UNMATCHING_BI_OPERATOR_SUBJECTS",EXPECTED_ARRAY:"EXPECTED_ARRAY",EXPECTED_OBJECT:"EXPECTED_OBJECT",EXPECTED_IDENTIFIER:"EXPECTED_IDENTIFIER",WRONG_ASSIGNMENT:"WRONG_ASSIGNMENT",WRONG_ASSIGNEE_TYPE:"WRONG_ASSIGNEE_TYPE",READONLY_ATTRIBUTE:"READONLY_ATTRIBUTE",WRONG_CONDITION:"WRONG_CONDITION",WRONG_CONDITION_VALUE:"WRONG_CONDITION_VALUE",EXECUTION_STEPS_EXCEEDED:"EXECUTION_STEPS_EXCEEDED",PARSER_STEPS_EXCEEDED:"PARSER_STEPS_EXCEEDED",PROTECTED_FROM_MODIFICATION:"PROTECTED_FROM_MODIFICATION",DIVISION_BY_ZERO:"DIVISION_BY_ZERO",UNKNOWN_ERROR:"UNKNOWN_ERROR"},r={NUMBER:"NUMBER",BOOLEAN:"BOOLEAN",STRING:"STRING",ARRAY:"ARRAY",OBJECT:"OBJECT",FUNCTION:"FUNCTION",VOID:"VOID"};class n extends Error{constructor(e,t,s,r){super(e),this.message=`${e} ${s?`"${s}"`:""} ${r?`"${r}"`:""}`,this.id=e,this.arg1=s,this.arg2=r,this.position=t,this.isLangError=!0}}class i{constructor(e){this.isExpression=!1,this.isAssignment=!1,this.isWhile=!1,this.isIf=!1,this.source=e}}class o{constructor(e,t=-1){this.op=e,this.isOperator=!0,this.precedence=t}}class a{constructor(e,t,s=r.OBJECT){this.value=e,this.type=s,this.isObject=!0,this.parent=null,this.source=t,this.eq=new p((e=>new h(function(e,t){const s=Object.keys(e.value),r=Object.keys(t.value);if(s.length!==r.length)return!1;for(k of s)if(!e.value[k].eq.call(t.value[k]))return!1;return!0}(this,e)))),this.ne=new p((e=>new h(!this.eq.call(e).value)))}attribute(e,t){const s=this[e]?this[e]:this.value[e];return t&&this.value[e]&&(this.value[e]=t),s||(this.parent?this.parent.attribute(e):void 0)}hasAttribute(e){return this[e]||this.value[e]||this.parent&&this.parent.hasAttribute(e)}protected(){return this.isProtected||this.parent&&this.parent.protected()}}class c extends a{constructor(e,t,s){super(e,t,s),this.eq=new p((e=>new h(this.value===e.value))),this.ne=new p((e=>new h(this.value!==e.value)))}}class l extends c{constructor(e,t){super(e,t,r.NUMBER),this.mult=new p((e=>new l(this.value*e.value))),this.div=new p((e=>new l(this.value/e.value))),this.mod=new p((e=>new l(this.value%e.value))),this.plus=new p((e=>new l(this.value+e.value))),this.minus=new p((e=>new l(this.value-e.value))),this.lt=new p((e=>new h(this.value<e.value))),this.le=new p((e=>new h(this.value<=e.value))),this.gt=new p((e=>new h(this.value>e.value))),this.ge=new p((e=>new h(this.value>=e.value))),this.neg=new p((()=>new l(-this.value))),this.sum=new p(((...e)=>new l(e.reduce(((e,t)=>e+t.value),this.value))))}}class u extends c{constructor(e,s){super(e,s,r.STRING),this.concat=new p((e=>new u(this.value+e.value))),this.length=new p((()=>new l(this.value.length))),this.plus=this.concat;for(let e of t)this[e]=new l(this.value.length)}}class h extends c{constructor(e,t){super(e,t,r.BOOLEAN),this.and=new p((e=>new h(this.value&&e.value))),this.or=new p((e=>new h(this.value||e.value))),this.xor=new p((e=>new h(this.value?!e.value:e.value))),this.nand=new p((e=>new h(!(this.value&&e.value)))),this.neg=new p((()=>new h(!this.value))),this.mult=this.and,this.plus=this.or}}class E extends c{constructor(e,s){super(e,s,r.ARRAY),this.concat=new p((e=>new E(this.value.concat(e.value)))),this.plus=this.concat;for(let e of t)this[e]=new l(this.value.length);this.eq=new p((e=>{if(!e||!e.value)return new h(!1);if(this.value.length!==e.value.length)return new h(!1);for(let t=0;t<this.value.length;t++)if(!this.value[t].eq||!this.value[t].eq.isNative||!this.value[t].eq.call(e.value[t]).value)return new h(!1);return new h(!0)})),this.ne=new p((e=>new h(!this.eq.call(e).value)))}element(e,t){return e.reduce(((r,i,o)=>{const a=Math.ceil(i.value);if(a<0||a>=r.value.length)throw new n(s.ARRAY_INDEX_OUT_BOUNDS);const c=r.value[a];return t&&o===e.length-1&&(r.value[a]=t),c}),this)}attribute(e,r){if(t.includes(e.toLowerCase())){if(r)throw new n(s.READONLY_ATTRIBUTE);return new l(this.value.length)}return super.attribute(e,r)}hasAttribute(e){return t.includes(e.toLowerCase())||super.attribute(e,newValue)}}class p{constructor(e,t){this.type=r.FUNCTION,this.func=e,this.isNative=!0,this.source=t}call(...e){return this.func(...e)}}e.exports={Keywords:{TRUE:["true","pravda","wahr"],FALSE:["false","nepravda","unwahr"],IF:["if","pokud","falls"],ELSE:["else","jinak","sonst"],WHILE:["while","dokud","soweit"]},Errors:s,Interruptions:{USER_SUSSPEND:"USER_SUSSPEND"},Types:r,SizeKeywords:t,WhileKeywords:["while","dokud","solange"],IfKeywords:["if","pokud","falls"],ElseKeywords:["else","jinak","sonst"],Block:class{constructor(e,t){this.statements=e,this.source=t}},Assignment:class extends i{constructor(e,t,s){super(s),this.isAssignment=!0,this.left=e,this.right=t}},While:class extends i{constructor(e,t,s){super(s),this.isWhile=!0,this.condition=e,this.body=t}},If:class extends i{constructor(e,t,s,r){super(r),this.isIf=!0,this.condition=e,this.body=t,this.elseBody=s}},Expression:class extends i{constructor(e,t){super(t),this.isExpression=!0,this.parts=e}},Variable:class{constructor(e,t){this.isVariable=!0,this.name=e,this.source=t}},UniOperator:class extends o{constructor(e,t){super(e),this.isUni=!0,this.precedence=this.getPrecedence(),this.source=t}apply(e){const t=function(t){switch(t){case"!":case"-":return e.neg;default:throw new n(s.INVALID_UNI_OPERATOR,null,this.op)}}(this.op);if(!t||!t.call)throw new n(s.OPERATOR_NOT_APPLICABLE,null,this.op);return t.call()}getPrecedence(){switch(this.op){case"!":case"-":return 14}}},BiOperator:class extends o{constructor(e,t){super(e),this.isBi=!0,this.precedence=this.getPrecedence(),this.source=t}apply(e,t){const i=function(t){switch(t){case"*":return e.mult;case"/":return e.div;case"%":return e.mod;case"+":return e.plus;case"-":return e.minus;case"<":return e.lt;case"<=":return e.le;case">":return e.gt;case">=":return e.ge;case"=":return e.eq;case"!=":return e.ne;case"&":return e.and;case"|":return e.or;default:throw new n(s.INVALID_BI_OPERATOR,null,this.op)}}(this.op);if(!i||!i.call){if("="===this.op)return new h(!1);throw new n(s.OPERATOR_NOT_APPLICABLE,null,this.op)}if("/"===this.op&&r.NUMBER===t.type&&0===t.value)throw new n(s.DIVISION_BY_ZERO,null,this.op);return i.call(t)}getPrecedence(){switch(this.op){case"*":case"/":case"%":return 12;case"+":case"-":return 11;case"<":case"<=":case">":case">=":return 9;case"=":case"!=":return 8;case"&":return 4;case"|":return 3}}},ArrayAccess:class extends o{constructor(e,t){super("[]",17),this.isAccess=!0,this.isArrayAccess=!0,this.indexes=e,this.source=t}apply(e,t,s){return e.element(t,s)}},ObjectAccess:class extends o{constructor(e,t){super(".",17),this.isAccess=!0,this.isObjectAccess=!0,this.attrName=e,this.source=t}apply(e,t){return e.attribute(this.attrName,t)}},FunctionCall:class extends o{constructor(e,t){super("()",17),this.isAccess=!0,this.isCall=!0,this.params=e,this.source=t}},VarReference:class{constructor(e,t){this.isReference=!0,this.varName=e,this.source=t}},ParseError:class extends n{constructor(e,t,s,r){super(e,t,s,r),this.isParseError=!0}},InterpretError:class extends n{constructor(e,t,s,r){super(e,t,s,r),this.isInterpretError=!0}},Interrupt:class{constructor(e){this.id=e,this.isLangInterruption=!0}},Object:a,Number:l,String:u,Boolean:h,Array:E,Function:class{constructor(e,t,s){this.type=r.FUNCTION,this.body=e,this.args=t,this.isFunction=!0,this.source=s,this.eq=new p((e=>new h(!1))),this.ne=new p((e=>new h(!0)))}},NativeFunction:p,Void:class extends c{constructor(e){super(null,e,r.VOID),this.eq=new p((e=>new h(!1))),this.ne=new p((e=>new h(!1)))}}}},"./src/ludolfc.js":(e,t,s)=>{const r=s("./src/lang.js"),n=s("./src/parser.js"),i=s("./src/interpret.js");e.exports={LudolfC:class{constructor(e={},t={}){this.parser=new n,this.interpret=new i(e,t)}async execute(e){try{const t=this.parser.parse(e);return await this.interpret.execute(t)}catch(t){if(t.isLangError&&(t.position||0===t.position)){const{line:s,col:r}=function(e,t){let s=1,r=1;for(let n=0;n<e.length&&n<=t;n++)r++,"\n"===e[n]&&(s++,r=1);return r=Math.max(1,r-1),{line:s,col:r}}(e,t.position);t.line=s,t.col=r}throw t}}hasVariable(e){return this.interpret.variables.hasVariable(e)}getVariable(e){return this.interpret.variables.getVariable(e)}},lang:r}},"./src/parser.js":(e,t,s)=>{const{Errors:r,Keywords:n,WhileKeywords:i,IfKeywords:o,ElseKeywords:a,Block:c,Assignment:l,While:u,If:h,Expression:E,Variable:p,UniOperator:w,BiOperator:f,ArrayAccess:O,ObjectAccess:d,FunctionCall:N,VarReference:T,ParseError:_,Object:R,Number:v,String:P,Boolean:A,Array:I,Function:b,Void:g}=s("./src/lang.js"),m=["!","-"],S=["*","/","%","+","-","<","<=",">",">=","=","!=","&","|"],C="ěščřžťďýáíéúůüöäñĚŠČŘŽŤĎÝÁÍÉÚŮÜÖÄÑß",x=`[a-zA-Z_${C}][a-zA-Z0-9_${C}]*`,D=`\\((\\s*(${x})\\s*(,\\s*(${x}))*)?\\s*\\)\\s*{(.|\\s)*\\}`;class B{constructor(e,t=0){this.code=e+"\n",this.pos=0,this.startingAt=t}move(e=1){this.pos+=e}currentChar(){return this.code[this.pos]}remaining(e){return this.code.substring(this.pos,Math.min(e?this.pos+e:this.code.length-1,this.code.length-1))}next(e=1){return this.code.substring(Math.min(this.pos+1,this.code.length-1),Math.min(this.pos+1+e,this.code.length-1))}finished(){return this.pos>=this.code.length}absPos(){return this.pos+this.startingAt-1}}function y(e,t=!1){for(;!e.finished()&&/\s/.test(e.currentChar())&&(!t||"\n"!==e.currentChar());)e.move()}function U(e,t){const s=new RegExp(t);for(;!e.finished()&&!s.test(e.currentChar());)e.move()}function L(e){return e=e.toLowerCase(),Object.values(n).some((t=>t.includes(e)))||i.includes(e)||o.includes(e)}function M(e){return"\n"!==e&&/\s+/g.test(e)}function X(e){return M(e)||Y(e)||"("===e||")"===e||"["===e||"]"===e||"{"===e||"}"===e||"."===e||","===e||S.some((t=>t.startsWith(e)))||m.some((t=>t.startsWith(e)))}function Y(e){return"\n"===e||";"===e}function F(e){return'"'===e||"“"===e||"”"===e||"'"===e}function V(e,t){return t===e||"”"===e&&"“"===t}function W(e){return new RegExp(`^${x}$`).test(e)}function G(e){return i.some((t=>new RegExp(`^\\s*${t}\\s(.*)\\s{`).test(e)))}function k(e){return o.some((t=>new RegExp(`^\\s*${t}\\s(.*)\\s{`).test(e)))}function j(e){return a.some((t=>new RegExp(`^\\s*${t}\\s+{`).test(e)))}e.exports=class{constructor(){this.steps=0,this.maxSteps=1e6}parse(e){return this.steps=0,this.parseBlock(new B(e))}parseBlock(e){const t=[];for(;!e.finished();){const s=this.parseStatement(e);s&&t.push(s)}return new c(t,e.absPos())}parseStatement(e){this._stepper();let t="",s=null,n=!1;const i={arrays:0,objects:0};for(;!e.finished();e.move()){this._stepper();const a=e.currentChar();if(o=e.remaining(),new RegExp("^//").test(o))U(e,"\\n");else{if(!n&&F(a)){let s=a;do{t+=s,e.move(),s=e.currentChar()}while(!e.finished()&&!V(s,a))}if(s||!M(a)||!M(t.charAt(t.length-1))){if(s&&a!==s)throw new _(r.EXPECTED_SYMBOL,e.absPos(),s,a);if("="!==s||a!==s){if("["===a&&i.arrays++,"]"===a&&i.arrays--,"{"===a&&i.objects++,"}"===a&&i.objects--,Y(a)&&!i.arrays&&!i.objects){e.move();break}if(G(e.remaining())){if(t.length)throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),t);y(e),U(e,"\\s");const s=this.parseWhile(e);if(y(e,!0),!Y(e.currentChar()))throw new _(r.EXPEXTED_STATEMENT_END,e.absPos());return s}if(k(e.remaining())){if(t.length)throw new _(r.UNEXPECTED_SYMBOL,t);y(e),U(e,"\\s");const s=this.parseIf(e);if(y(e,!0),j(e.remaining())&&(y(e),U(e,"\\s"),s.elseBody=this.parseBody(e),y(e,!0)),!Y(e.currentChar()))throw new _(r.EXPEXTED_STATEMENT_END,e.absPos());if(!s.elseBody&&(y(e),j(e.remaining())&&(y(e),U(e,"\\s"),s.elseBody=this.parseBody(e),y(e,!0),!Y(e.currentChar()))))throw new _(r.EXPEXTED_STATEMENT_END,e.absPos());return s}if(":"!==a||i.objects){if(n){const s=this.parseExpression(e,i);if(t=t.trim(),W(t)){const r=new p(t,e.absPos());return new l(r,s,e.absPos())}{const n=this.parseExpression(new B(t,e.absPos()-t.length),{});if(!n||n.parts.some((e=>e.isOperator&&!e.isAccess)))throw new _(r.INVALID_IDENTIFIER,e.absPos(),t);return new l(n,s,e.absPos())}}t+=a}else{if(!t.trim().length)throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),a);if(L(t.trim()))throw new _(r.UNEXPEXTED_KEYWORD,e.absPos(),a);s="="}}else n=!0,s=null}}}var o;if(t.length)return this.parseExpression(new B(t,e.absPos()-t.length),{})}parseExpression(e,t,s=null){this._stepper();const n=[];for(;!e.finished();){this._stepper();const l=e.currentChar();if(M(l)){e.move();continue}if(Y(l)||")"===l||"]"===l||"}"===l||","===l){if(!(")"!==l&&"]"!==l&&"}"!==l||(s||s===l)&&n.length))throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),l);if(n.length){if(n[n.length-1].isOperator&&!n[n.length-1].isAccess)throw new _(r.UNEVEN_OPERATORS,e.absPos());return new E(n,e.absPos())}e.move();continue}if(o=e.remaining(),new RegExp(`^${D}`).test(o)){if(n.length&&!n[n.length-1].isOperator)throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),l);const t=this.parseFunction(e);n.push(t);continue}if("{"===l){if(!a())throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),l);e.move();const s=this.readAttributes(e,")");if(y(e),"}"===e.currentChar()){const r=new R(s,e.absPos());for(let e of Object.values(s))e.isObject&&(e.parent=r);n.push(r),e.move(),t.objects--;continue}throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),e.currentChar(),"}")}if("("===l){if(e.move(),c()){const t=this.readList(e,")");if(y(e),")"!==e.currentChar())throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),e.currentChar(),")");var i=new N(t,e.absPos());n.push(i),e.move()}else{const s=this.parseExpression(e,t,!0);if(n.push(s),y(e),")"!==e.currentChar())throw new _(r.EXPECTED_SYMBOL,e.absPos(),")");e.move()}continue}if("."===l&&c()){e.move();const t=this.readIdentifier(e);n.push(new d(t,e.absPos()));continue}if("["===l){if(e.move(),c()){const t=this.readList(e,"]");if(y(e),!t.length)throw new _(r.ARRAY_INDEX_MISSING,e.absPos());if("]"!==e.currentChar())throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),e.currentChar(),"]");if(t.some((e=>!e.isExpression||!e.parts.length)))throw new _(r.ARRAY_INDEX_NOT_NUMBER,e.absPos());e.move(),n.push(new O(t,e.absPos()))}else{const s=this.readList(e,"]");if(y(e),"]"!==e.currentChar())throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),e.currentChar(),"]");n.push(new I(s,e.absPos())),e.move(),t.arrays--}continue}if(a()){if(m.includes(l)){if(n.push(new w(l,e.absPos())),e.move(),M(e.currentChar()))throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),e.currentChar());continue}}else if(c()){const t=e.remaining(2);if(S.includes(t)){n.push(new f(t,e.absPos())),e.move(t.length);continue}if(S.includes(l)){n.push(new f(l,e.absPos())),e.move();continue}}if(n.length&&(!n[n.length-1].isOperator||n[n.length-1].isAccess))throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),e.currentChar());const u=this.parseMemberExpression(e);n.push(u)}var o;function a(){return!n.length||n[n.length-1].isOperator&&!n[n.length-1].isAccess}function c(){return n.length&&(!n[n.length-1].isOperator||n[n.length-1].isAccess)}}parseMemberExpression(e){this._stepper();let t="";for(;!e.finished();e.move()){this._stepper();const i=e.currentChar();if(X(i)){if("."===i&&/^(0|([1-9][0-9]*))$/.test(t)&&/[0-9]/.test(e.next())){t+=i;continue}if(n.TRUE.includes(t.toLowerCase()))return new A(!0,e.absPos());if(n.FALSE.includes(t.toLowerCase()))return new A(!1,e.absPos());if(s=t,!isNaN(s)&&!isNaN(parseFloat(s)))return new v(t.includes(".")?parseFloat(t):parseInt(t),e.absPos());if(W(t)||"$"===t)return new T(t,e.absPos());throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),t)}if(F(i))return e.move(),new P(this.readString(e,i),e.absPos());t+=i}var s}readList(e,t){if(y(e),t===e.currentChar())return[];{const s=[];do{const r=this.parseExpression(e,{},t);s.push(r),y(e)}while(","===e.currentChar()&&!e.finished());return s}}readAttributes(e){if(y(e),"}"===e.currentChar())return{};{const t={};let s=!0;do{s||e.move(),s=!1,y(e);const n=this.readIdentifier(e);if(t[n])throw new _(r.ATTRIBUTE_ALREADY_EXISTS,e.absPos(),n);if(y(e),":"!==e.currentChar())throw new _(r.EXPECTED_SYMBOL,e.absPos(),":",e.currentChar());e.move();const i=this.parseExpression(e,{},"}");t[n]=i,y(e)}while(","===e.currentChar()&&!e.finished());return t}}parseWhile(e){const t=this.readUntilBodyOpens(e),s=this.parseExpression(new B(t,e.absPos()-t.length),{},null),r=this.parseBody(e);return new u(s,r,e.absPos())}parseIf(e){const t=this.readUntilBodyOpens(e),s=this.parseExpression(new B(t,e.absPos()-t.length),{},null),r=this.parseBody(e);return new h(s,r,null,e.absPos())}parseFunction(e){const t=this.readArguments(e),s=this.parseBody(e);return new b(s,t,e.absPos())}readArguments(e){if(y(e),"("!==e.currentChar())throw new _(r.EXPECTED_SYMBOL,e.absPos(),"(",e.currentChar());e.move(),y(e);const t=[];let s=!0;for(;(","===e.currentChar()||")"!==e.currentChar())&&!e.finished();){s||e.move(),s=!1;const r=this.readIdentifier(e);t.push(r),y(e)}if(")"!==e.currentChar())throw new _(r.EXPECTED_SYMBOL,e.absPos(),")",e.currentChar());return e.move(),t}parseBody(e){if(y(e),"{"!==e.currentChar())throw new _(r.EXPECTED_SYMBOL,e.absPos(),"{",e.currentChar());e.move(),y(e);let t="",s=0;for(;(s||"}"!==e.currentChar())&&!e.finished();){const r=e.currentChar();t+=r,e.move(),"{"===r&&s++,"}"===r&&s--}if("}"!==e.currentChar())throw new _(r.EXPECTED_SYMBOL,e.absPos(),"}",e.currentChar());return e.move(),/^\s*$/.test(t)?new c([new g(e.absPos())],e.absPos()):this.parseBlock(new B(t,e.absPos()-t.length))}readString(e,t){let s="";for(;!e.finished();e.move()){const r=e.currentChar();if(V(r,t))return e.move(),s;s+=r}throw new _(r.UNEXPECTED_END,e.absPos())}readIdentifier(e){let t="";for(;!e.finished();e.move()){const s=e.currentChar();if(!M(s)){if(!new RegExp(`^${x}$`).test(t+s))break;t+=s}}if(t)return t;throw new _(r.EXPECTED_IDENTIFIER,e.absPos())}readUntilBodyOpens(e){let t=0,s=0,n="";for(;!e.finished();e.move()){const i=e.currentChar();if(F(i))n+=this.readString(e,i);else{if("("===i)s++;else if(")"===i)s--;else if("{"===i){if(!t&&!s)break;t++}else if("}"===i&&(t--,t<0))throw new _(r.UNEXPECTED_SYMBOL,e.absPos(),i);n+=i}}if(n)return n}_stepper(){if(this.steps++,this.steps>this.maxSteps)throw new _(r.PARSER_STEPS_EXCEEDED,source.absPos())}}}},t={},s=function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports}("./src/ludolfc.js");return s})(),e.exports=t()}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,s),i.exports}(()=>{"use strict";var e=s(385);function t(e){return"VOID"===e.type?"":"ARRAY"===e.type?"["+e.value.map(t)+"]":"OBJECT"===e.type?"{"+Object.keys(e.value).map((s=>s+":"+t(e.value[s])))+"}":"BOOLEAN"===e.type?e.value?"<b>✓</b>":"<b>✗</b>":"STRING"===e.type?e.value:null!==e.value&&void 0!==e.value?t(e.value):e.isFunction?"[function]":JSON.stringify(e)}const r=11,n=Math.floor(r/2),i=[];for(let e=0;e<r;e++)i[e]=[];for(let e=2;e<r-2;e++)for(let t=2;t<r-2;t++)i[e][t]=a(t,e,4,i[e][t]);for(let e=0;e<r;e++)for(let t=0;t<r;t++)i[e][t]=a(t,e,3,i[e][t]);i[n][n]=2,i[n+1][n]=0;const o=[];function a(e,t,s,i){let o=1;if(3===s){const s=Math.abs(e-(r-1)/2),n=Math.abs(t-(r-1)/2);o=Math.max(s,n)/15}else if(4===s&&(o=.3,e>n-2&&e<n+2||t>n-2&&t<n+2))return i;return Math.round(.3*Math.random()+o)?s:i}i.forEach(((e,t)=>o[t]=[...e]));const c={raw:i,mapped:function(t){const s=t.map((t=>n(t.map((t=>new e.lang.Number(t)))))),r=n(s);return r.isMap=!0,r;function n(t){const s=new e.lang.Array(t);return s.isProtected=!0,s}}(i),reset:()=>i.forEach(((e,t)=>e.map(((e,s)=>i[t][s]=e))))},l={x:n,y:n+1},u={move:null},h={position:l,callback:u,up:new e.lang.NativeFunction((async()=>{console.debug("Robot up"),l.y++,u.move&&await u.move()})),down:new e.lang.NativeFunction((async()=>{console.debug("Robot down"),l.y--,u.move&&await u.move()})),right:new e.lang.NativeFunction((async()=>{console.debug("Robot right"),l.x++,u.move&&await u.move()})),left:new e.lang.NativeFunction((async()=>{console.debug("Robot left"),l.x--,u.move&&await u.move()}))},E=new e.lang.Object(h);E.isRobot=!0,E.isProtected=!0,h.nahoru=h.up,h.nachOben=h.up,h["dolů"]=h.down,h.nachUnten=h.down,h.vpravo=h.right,h.rechts=h.right,h.vlevo=h.left,h.links=h.left;const p={raw:h,mapped:E,reset:()=>{l.x=n,l.y=n+1}},w=document.getElementById("map"),f=document.getElementById("result");async function O(...e){e&&e[0]&&(e.some((e=>e.isMap||e.isRobot))&&function(e=!0){e&&d();const t=c.raw,s=p.raw,r=t.length;let n="";for(let e=r-1;e>=0;e--){n+="<tr>";for(let i=0;i<r;i++)n+=`<td class="map-cell map-${e}-${i} map-value-${i===s.position.x&&e===s.position.y?1:t[e][i]} `,0!==e&&0!==i&&e!==r-1&&i!==r-1||(n+="side "),0===e&&0===i?n+="corner bottom-left":0===e&&i===r-1?n+="corner bottom-right":e===r-1&&0===i?n+="corner top-left":e===r-1&&i===r-1&&(n+="corner top-right"),n+='">&nbsp;</td>';n+="</tr>"}w.innerHTML=n}(1===e.length),f.innerHTML=e.filter((e=>!e.isMap&&!e.isRobot)).map((e=>t(e))).join(" "),await function(e=500){return new Promise((t=>setTimeout(t,e)))}())}function d(){f.innerHTML="",w.innerHTML=""}p.raw.callback.move=async()=>await O(c.mapped);let N=(localStorage.getItem("localization")||navigator.language||"en").substring(0,2);const T={en:'i := 3\nwhile i > 0 {\n  Display(i, "...")\n  i := i - 1\n}\nDisplay(Map)',de:'i := 3\nsolange i > 0 {\n  Darstellen(i, "...")\n  i := i - 1\n}\nDarstellen(Map)',cs:'i := 3\ndokud i > 0 {\n  Zobraz(i, "...")\n  i := i - 1\n}\nZobraz(Map)'};function _(){document.querySelectorAll(".localization:not(."+N+")").forEach((e=>e.classList.remove("current"))),document.querySelectorAll(".localization."+N).forEach((e=>e.classList.add("current")))}_();const R=()=>T[N],v=new e.lang.NativeFunction(((...e)=>O(...e))),P={Display:v,Zobraz:v,Darstellen:v,Map:c.mapped,Mapa:c.mapped,Karte:c.mapped,Ludolf:p.mapped};let A=!1;const I={isInterrupted:()=>A},b=new e.LudolfC(P,I),g=document.getElementById("code"),m=document.getElementById("position"),S=document.getElementById("errorMarker"),C=document.querySelector(".line-numbers"),x=document.getElementById("display"),D=document.getElementById("result"),B=document.getElementById("runButton"),y=document.querySelectorAll(".controls .char"),U=document.getElementById("map");let L,M,X=!1;function Y(){const e=g.value.split("\n").length;C.innerHTML=Array(e).fill("<span></span>").join("")}function F(e){e=e.replace("&lt;","<").replace("&gt;",">");const t=g.selectionStart,s=g.selectionEnd;g.value=g.value.substring(0,t)+e+g.value.substring(s),g.selectionEnd=t+1,g.focus()}function V(){const e=g.value,t=g.selectionEnd;let s=1,r=1;for(let n=0;n<e.length&&n<t;n++)r++,"\n"===e[n]&&(s++,r=1);m.innerHTML=s+":"+r}function W(e,t){if(G(),!e||!t)return;L=e,M=t;let{top:s}=o(C);const{left:r}=o(g);s+=C.childNodes[0].offsetHeight*(e-1);const n=S.offsetWidth,i=S.cloneNode(!0);function o(e){let t=0,s=0;for(;null!==e;)t+=e.offsetTop,s+=e.offsetLeft,e=e.offsetParent;return{top:t,left:s}}i.id=S.id+"-copy",i.style.visibility="visible",i.style.letterSpacing=4*n+"px",i.style.top=s+"px",i.style.left=r+n+(n*t-3*n)+"px",S.parentNode.insertBefore(i,S)}function G(){const e=document.getElementById(S.id+"-copy");e&&e.remove(),L=null,M=null}function k(){localStorage.setItem("ludolfcCode",g.value)}function j(){const e=localStorage.getItem("ludolfcCode");g.value=e||R()}function $(){x.style.height=x.offsetWidth+"px",L&&M&&W(L,M)}B.addEventListener("click",(async()=>{if(X)A=!0;else{X=!0,G(),d(),k(),B.classList.remove("run"),B.classList.add("stop"),U.classList.remove("interrupted"),c.reset(),p.reset(),D.classList.contains("error")&&D.classList.remove("error");try{const e=t(await b.execute(g.value));e&&(D.innerHTML=e)}catch(e){if(U.classList.add("interrupted"),e.isLangInterruption)return void(D.innerHTML+='\n<div class="error">❌⛔❌</div>');if(console.error(e),D.classList.contains("error")||D.classList.add("error"),e.isLangError){const t=e.line||0,s=e.col||0;D.innerHTML=(e.isParseError?"PARSE ":"")+"ERROR"+(t&&s?" (ln "+t+", col "+s+")":"")+":<br>"+e.message,W(t,e.col)}else D.innerHTML="ERROR "+e}finally{B.classList.add("run"),B.classList.remove("stop"),A=!1,X=!1}}})),j(),Y(),g.addEventListener("keyup",(e=>{V(),Y(),G(),k()})),g.addEventListener("keydown",(e=>{"Tab"===e.key&&(F("  "),e.preventDefault())})),g.addEventListener("mouseup",(e=>V())),y.forEach((e=>e.addEventListener("click",(t=>F(e.innerHTML))))),$(),addEventListener("resize",(e=>$())),document.querySelectorAll(".localization-control").forEach((e=>e.addEventListener("click",(()=>{var t;t=e.getAttribute("lang"),N=t||"en",localStorage.setItem("localization",N),_(),j()}))))})()})();